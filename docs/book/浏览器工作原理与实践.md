极客时间《浏览器工作原理与实践》

## 第一章 重要性及要学的知识 2021.11.24

前端 80%的难题都跟浏览器的工作原理有关。学习目的：知识点串连成线，连成网，形成自己的知识体系

站在用户角度衡量性能

1. 页面加载时间：1s 内看到关键内容，衡量指标，FP,FCP,FMP,LCP,FSP，TODO:如何收集及如何进行数据分析？
2. 页面响应时间：点击按钮，100ms 内响应，FID
3. 动画卡顿：60FPS

首屏显示涉及，DNS, HTTP, DOM 解析，CSS 阻塞，JavaScript 阻塞等技术因素

Node 是基于 Chrome 的 V8 引擎实现的。

前端技术如何针对这些核心诉求做演进的。

1. 脚本执行速度：

-   修订语言本身，ES6 ES20, TS
-   使用新语言 WebAssembly. TODO: 对 Webcomponents 做一些了解，是什么，解决了什么问题，适用哪些场景

2. 前端模块化：
   commonJS
   ES6 Module
   Webcomponents 涉及到的 Shadow DOM，HTML Templates。TODO: 对 Webcomponents 做一些了解，是什么，解决了什么问题，适用哪些场景
3. 渲染效率问题
   页面渲染存在一些问题，下一代布局方案 TODO:LayoutNG，渲染瘦身方案 TODO:Slim Paint.

## 第二章 chrome 架构 2021.11.25

设计高性能 web，需要了解网络流程，页面渲染流程，javascript 执行流程，网络完全理论。通过浏览器的多进程架构可以把知识串联起来。

线程和进程：进程是一个程序运行的实例。启动一个程序时，操作系统会为该程序创建一块内存，来存放代码，运行中的数据和一个执行任务。
之间的关系:

1. 进程中任一一个线程出错，会导致整个进程的崩溃
2. 线程之间共享进程中的数据
3. 当一个进程关闭后，会回收其做占用的内存
4. 进程之间的内容相互隔离，通过 IPC 进行通信，TODO:IPC 是啥

浏览器的发展历史：

1. 最初始的单进程架构，因为存在不稳定（一个线程崩溃了，则浏览器就崩溃了，），不流畅（如果 js 执行时间过长，则其他的任务就只能等待， 而且只有浏览器关掉才会有内存回收），不安全（可以访问操作系统，也可以插入恶意代码盗取账号）的问题，
2. 后来修改为为多进程架构，解决不稳定（一个进程崩溃了，不会影响其他的，），不流畅（很多任务都是在不同进程中执行的，关掉一个页面就会进行内存回收），不安全（每个进程都是一个安全沙箱，无法访问操作系统）的问题
   多进程：

-   浏览器进程：负责页面展示，用户交互，子进程管理，同时提供存储功能
-   渲染进程：JS, css，html 转化为网页，排版引擎 Blink，JS V8 引擎都是运行在该进程中。每个 tab 标签都会创建一个渲染进程。运行在沙箱模式下。
-   GPU 进程：最初是为了 3d css，后来使用其进行页面绘制，TODO:了解各进程之间是如何协作的
-   网络进程:
-   插件进程

存在的问题：1、更好的内存占用 2、更复杂的架构体系：浏览器各模块耦合性强，可拓展性差

3. 未来的浏览器架构，面向服务的架构。
   各模块做成独立的服务，每个服务运行在独立的进程中。访问服务必须使用定义好的接口，通过 IPC 来通信

## TCP 协议：如果保证页面文件安全完整送到浏览器 2021.11.26

FP: 从页面加载到开始绘制的时间。这是一个重要的衡量网络性能的指标。什么影响了它呢，一个因为就是网络加载速度。
数据是被拆成一个个数据包去进行传输的。

数据包的路程
数据如何送达主机：通过 IP，把数据包发给指定的电脑。IP 是网络层的协议，指计算机的地址。有了 IP 地址，一个数据包是就可以从主机 A 传到主机 B。
主机如何将数据包交给应用程序: UDP 通过端口号把数据包发给特定的应用程序
主机如何将数据包完成地交给应用程序：TCP，保证了数据完整性传输，它的连接分为 3 个阶段：建立连接，传输阶段，断开连接

UDP：传输速度快，但是有丢包和没有顺序的问题。适合在线视频和网络游戏等对速度要求很高的
邮件等对数据要求很高的，使用 UDP 会有问题，于是有了 TCP 协议
TCP 协议是面向链接，可靠的，面向字节流的传输协议，和 UDP 相比，它有以下有两点：

1. 丢包重传机制。发数据包的时候，还需要接收方在一定时间内发确认收到的消息，如何没有，就认为数据包丢失，重新发送。
2. 数据包排序机制。数据包的 TCP 都序号，在收到后会按照序号重新排序组装数据包。

TCP 的传输过程

1. 建立连接：通过 3 次握手建立连接，即发 3 个数据包确认建立连接
2. 传输阶段：需要接收方进行数据确认操作。发数据包的时候，还需要接收方在一定时间内发确认收到的消息，如何没有，就认为数据包丢失，重新发送；接受方接受到数据后会按照 TCP 头部序号进行排序
3. 断开连接：通过 4 次挥手

TODO:为什么要是 3 次握手和 4 次挥手

HTTP 与 TCP，IP 的关系
HTTP 是应用层，TCP 是传输层，IP 是网络层
HTTP 在 TCP 之上，规定了传输数据包的数据格式。
